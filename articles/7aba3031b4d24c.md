---
title: "monorepoæ§‹æˆã§ã€Reactã‚¢ãƒ—ãƒªã¨Firebase Functionsã‚’åŒå±…ã•ã›ã‚‹"
emoji: "ğŸ§"
type: "tech"
topics: ["firebase", "react", "monorepo"]
published: true
---

<!-- textlint-disable -->

# TL;DR
monorepoæ§‹æˆã§Reactã‚¢ãƒ—ãƒªã¨Firebase Functionsã‚’åŒã˜ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã—ã€å…±é€šã®ãƒ­ã‚¸ãƒƒã‚¯ã‚„å‹ã‚’ä½¿ã„ã¾ã‚ã›ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

https://github.com/Alesion30/monorepo-react-app

# ãƒ¢ãƒãƒ¬ãƒï¼ˆmonorepoï¼‰ã¨ã¯ï¼Ÿ

ãƒ¢ãƒãƒ¬ãƒã¨ã¯ã€åŒä¸€ã®ãƒªãƒã‚¸ãƒˆãƒªã«è¤‡æ•°ã®ã‚¢ãƒ—ãƒªã‚„ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ç®¡ç†ã™ã‚‹æ‰‹æ³•ã®ã“ã¨ã‚’æŒ‡ã—ã¾ã™ã€‚è¤‡æ•°ã®ã‚¢ãƒ—ãƒªã®PRã‚„ã‚³ãƒ¼ãƒ‰å·®åˆ†ãªã©ã‚’1ã¤ã®ãƒªãƒã‚¸ãƒˆãƒªã§ç®¡ç†ã™ã‚‹ãŸã‚ç…©é›‘ã«ãªã‚Šã‚„ã™ã„ã¨ã„ã†ãƒ‡ãƒ¡ãƒªãƒƒãƒˆã¯ã‚ã‚Šã¤ã¤ã‚‚ã€å…±é€šã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’ä½¿ã„ã¾ã‚ã›ãŸã‚Šã€å˜ä¸€ã®ä¾å­˜ãƒ•ã‚¡ã‚¤ãƒ«ã§ç®¡ç†ã§ãã‚‹ã¨ã„ã£ãŸæ©æµã‚’å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

ãƒ¢ãƒãƒ¬ãƒã«ã¤ã„ã¦ã¯ã€CircleCIã®ãƒ–ãƒ­ã‚°ã«ã‚ã‹ã‚Šã‚„ã™ãã¾ã¨ã‚ã‚‰ã‚Œã¦ã„ã¾ã™ã€‚
https://circleci.com/ja/blog/monorepo-dev-practices/

ä»Šå›ã¯ã€yarnã®`workspaces`ã¨ã„ã†æ©Ÿèƒ½ã‚’ç”¨ã„ã¦ã€Reactã‚¢ãƒ—ãƒªã¨Firebase Functionsã‚’ãƒ¢ãƒãƒ¬ãƒã§ç®¡ç†ã—ã¦ã„ã“ã†ã¨æ€ã„ã¾ã™ã€‚

https://classic.yarnpkg.com/lang/en/docs/workspaces/

# ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

`monorepo-react-app`ã¨ã„ã†åå‰ã§ã€å®Ÿè£…ã‚’é€²ã‚ã¦ã„ãã¾ã™ã€‚ã¾ãŸã€yarnã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯`3.0.0`ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

```sh
$ mkdir monorepo-react-app
$ cd monorepo-react-app
monorepo-react-app:$ yarn init -y
monorepo-react-app:$ yarn set version 3.0.0
```

```yml:.yarnrc.yml
# nodeLinkerã‚’è¿½åŠ ã™ã‚‹
nodeLinker: node-modules
yarnPath: .yarn/releases/yarn-3.0.0.cjs
```

.gitignoreãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```sh
monorepo-react-app:$ touch .gitignore
```

```txt:.gitignore
# dependencies
**/node_modules
**/.pnp
**/.pnp.js

# testing
**/coverage

# yarn
.yarn/*
!.yarn/patches
!.yarn/plugins
!.yarn/releases
!.yarn/sdks
!.yarn/versions

# misc
**/.DS_Store
.env.local
.env.development.local
.env.test.local
.env.production.local

# log
**/npm-debug.log*
**/yarn-debug.log*
**/yarn-error.log*
```

packagesãƒ•ã‚©ãƒ«ãƒ€ã«ãã‚Œãã‚Œã®ã‚¢ãƒ—ãƒªï¼ˆReactãƒ»Firebase Functionsï¼‰ã‚’ç®¡ç†ã—ã¦ã„ãã¾ã™ã€‚

```sh
monorepo-react-app:$ mkdir packages
```

```json:./package.json
{
  "name": "monorepo-react-app",
  "private": true,
  // workspacesã‚’è¿½åŠ ã™ã‚‹
  "workspaces": {
    "packages": [
      "packages/*"
    ]
  },
  "packageManager": "yarn@3.2.0"
}
```

# Reactã®ç’°å¢ƒæ§‹ç¯‰

æœ¬è¨˜äº‹ã§ã¯ã€create-react-appã§ã¯ãªãã€viteã§ã‚¢ãƒ—ãƒªã‚’æ§‹ç¯‰ã—ã¾ã™ã€‚

https://ja.vitejs.dev/

```sh
monorepo-react-app:$ yarn create vite packages/client --template react-ts
```

:::message
lockãƒ•ã‚¡ã‚¤ãƒ«ã¯ãƒ«ãƒ¼ãƒˆã§ç®¡ç†ã™ã‚‹ã®ã§ã€packages/clientä»¥ä¸‹ã§ç”Ÿæˆã•ã‚ŒãŸpackage-lock.jsonã‚„yarn.lockã¯å‰Šé™¤ã—ã¦ãŠãã¾ã™ã€‚
:::

package.jsonã®`name`ãŒ`client`ã«ãªã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

```json:packages/client/package.json
{
  "name": "client",
  "private": true,
  "version": "0.0.0",
  // ...
}
```

:::message
package.jsonã®nameã®å€¤ãŒã€workspaceã§ä½¿ç”¨ã•ã‚Œã‚‹åå‰ã«ãªã‚Šã¾ã™ã€‚
(e.g. `yarn workspace ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹å dev`)
:::

```sh
monorepo-react-app:$ yarn install
monorepo-react-app:$ yarn workspace client dev
```

![](https://storage.googleapis.com/zenn-user-upload/29709c92c00b-20220503.png)

# Firebase Functionsã®ç’°å¢ƒæ§‹ç¯‰

firebase cliã‚’å°å…¥ã—ã¦ã„ãªã„æ–¹ã¯ã€å…ˆã«ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

https://firebase.google.com/docs/cli

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å©ãã¨ã€`functions`ãƒ•ã‚©ãƒ«ãƒ€ãƒ»`.firebaserc`ãƒ»`firebase.json`ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

```sh
monorepo-react-app:$ firebase init functions
```

`functions`ãƒ•ã‚©ãƒ«ãƒ€ã‚’`packages`ãƒ•ã‚©ãƒ«ãƒ€ã«ç§»å‹•ã•ã›ã¾ã™ã€‚

firebase.jsonã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¾ã™ã€‚

```json:firebase.json
{
  "functions": {
    "predeploy": "yarn workspace functions run build",
    "source": "packages/functions"
  }
}
```

src/index.tsã«helloWorldé–¢æ•°ã‚’è¿½åŠ ã—ã¦ãŠãã¾ã™ã€‚

```ts:packages/functions/src/index.ts
import * as functions from "firebase-functions";

// Start writing Firebase Functions
// https://firebase.google.com/docs/functions/typescript
export const helloWorld = functions.https.onRequest((request, response) => {
  functions.logger.info("Hello logs!", {structuredData: true});
  response.send("Hello from Firebase!");
});
```

```sh
monorepo-react-app:$ yarn workspace functions build
```

# TypeScriptã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’çµ±ä¸€ã™ã‚‹

clientã¨functionsã®TypeScriptã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒä¸€è‡´ã—ã¦ã„ãªã„ã®ã§ã€ãƒ«ãƒ¼ãƒˆã®package.jsonã§TypeScriptã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç®¡ç†ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

ã¾ãšã€ã™ã§ã«ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ã‚‹TypeScriptã‚’å‰Šé™¤ã—ã¾ã™ã€‚

```sh
monorepo-react-app:$ yarn workspace client remove typescript
monorepo-react-app:$ yarn workspace functions remove typescript
```

TypeScriptã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```sh
monorepo-react-app:$ yarn add -D typescript
```

# eslintãƒ»prettierã‚’å°å…¥

```sh
monorepo-react-app:$ yarn add -D eslint eslint-config-prettier eslint-plugin-import eslint-plugin-react eslint-plugin-sort @typescript-eslint/eslint-plugin @typescript-eslint/parser prettier prettier-plugin-sort-json
```

eslintã¨prettierã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚

```sh
monorepo-react-app:$ touch .eslintrc .eslintignore .prettierrc .prettierignore
```

```json:.eslintrc
{
  "env": {
    "browser": true,
    "es2017": true,
    "node": true
  },
  "extends": [
    "eslint:recommended",
    "plugin:import/recommended",
    "plugin:react/recommended",
    "plugin:sort/recommended",
    "plugin:@typescript-eslint/recommended",
    "prettier"
  ],
  "parser": "@typescript-eslint/parser",
  "parserOptions": {
    "ecmaVersion": 2021,
    "sourceType": "module"
  },
  "plugins": ["import", "sort", "@typescript-eslint"],
  "root": true,
  "rules": {
    "@typescript-eslint/no-unused-vars": [
      "error",
      {
        "argsIgnorePattern": "^_"
      }
    ],
    "import/no-unresolved": [
      "error",
      {
        "ignore": ["\\?raw$"]
      }
    ],
    "import/order": [
      "error",
      {
        "alphabetize": {
          "order": "asc"
        },
        "newlines-between": "always"
      }
    ],
    "react/jsx-sort-props": [
      "error",
      {
        "reservedFirst": true,
        "shorthandFirst": true
      }
    ],
    "react/prop-types": ["off"],
    "react/react-in-jsx-scope": "off",
    "sort/imports": ["off"]
  },
  "settings": {
    "import/resolver": {
      "node": {
        "extensions": [".js", ".jsx", ".ts", ".tsx"]
      }
    },
    "react": {
      "version": "detect"
    }
  }
}
```

```.eslintignore
**/node_modules/*
**/dist/*
**/lib/*
.yarn
```

```json:.prettierrc
{
  "jsonRecursiveSort": true,
  "trailingComma": "all"
}
```

```.prettierignore
**/node_modules/*
**/dist/*
**/lib/*
.yarn
*.md
```

# å‚è€ƒè¨˜äº‹
https://ito-u-oti.com/react-monorepo/
https://zenn.dev/takanori_is/articles/tsconfig-in-monorepo
https://qiita.com/sisisin/items/954cf6b3464233e2d010
https://blog.cybozu.io/entry/2020/04/21/080000
