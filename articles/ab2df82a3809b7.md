---
title: "MVVM+Repositoryãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æ¡ç”¨ã—ãŸFlutterã‚¢ãƒ—ãƒªã‚’æ§‹ç¯‰ã™ã‚‹"
emoji: "ğŸ¶"
type: "tech"
topics: ["flutter", "riverpod", "mvvm", "ã‚¢ãƒ—ãƒªé–‹ç™º"]
published: true
---

# ã“ã®è¨˜äº‹ã«ã¤ã„ã¦

<!-- textlint-disable -->

[wasabeef](https://github.com/wasabeef)ã•ã‚“ãŒä½œæˆã—ã¦ã„ã‚‹ãƒªãƒã‚¸ãƒˆãƒªã‚’å‚è€ƒã«ã€ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºã—ã¦ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½œæˆã—ã¦ã¿ãŸã¨ã„ã†è‡ªåˆ†ç”¨ãƒ¡ãƒ¢çš„ãªè¨˜äº‹ã§ã™ã€‚å°å…¥æ‰‹é †ã‚’ã‹ãªã‚Šä¸å¯§ã«æ›¸ã„ãŸã¤ã‚‚ã‚Šãªã®ã§ã€ã‚ã¡ã‚ƒãã¡ã‚ƒæ–‡å­—æ•°ãŒå¤šããªã£ã¡ã‚ƒã£ã¦ã„ã¾ã™ğŸ’¦ï¼ˆè„…å¨ã®50000æ–‡å­—overï¼‰ã€‚
wasabeefã•ã‚“ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã§ã¯ã€`ChangeNotifier`ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ãŒã€ã“ã®è¨˜äº‹ã§ã¯ã€`StateNotifier`ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚ã¾ãŸã€`Sizer`ãƒ»`Fimber`ãƒ»`Device Preview`ãªã©ã‚‚æ–°ãŸã«å°å…¥ã—ã¦ã„ã¾ã™ã€‚é€†ã«ã€`Dio`ã®å°å…¥ã¯ã—ã¦ã„ã¾ã›ã‚“ã€‚ã“ã‚Œã¯ã€`http`ã¨ã„ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ã£ãŸæ–¹ãŒè‰¯ã„ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚Šã¾ã™ã—ã€ãã‚‚ãã‚‚`Firebase`ã‚’ä½¿ç”¨ã—ã¦ã„ã¦ã€ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰APIã‚’å©ãå¿…è¦ãŒãªã„ã‚±ãƒ¼ã‚¹ã‚‚ã‚ã‚‹ã‹ã¨æ€ã„ã¾ã™ã®ã§ã€å¿…è¦ã«å¿œã˜ã¦ã€ä¸‹è¨˜ã®ãƒªãƒã‚¸ãƒˆãƒªã‚’å‚è€ƒã«ã—ã¦ã¿ã¦ãã ã•ã„ã€‚

https://github.com/wasabeef/flutter-architecture-blueprints


# MVVM+Repositoryãƒ‘ã‚¿ãƒ¼ãƒ³ã¨ã¯ï¼Ÿ

MVVMã¨ã¯ã€Modelãƒ»Viewãƒ»ViewModelã§æ§‹æˆã•ã‚ŒãŸã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ã“ã¨ã§ã™ã€‚MVVMã¯ã€Androidã‚¢ãƒ—ãƒªé–‹ç™ºã§ã¯ã€å®šç•ªï¼Ÿã€€ã®ã‚ˆã†ã§ã™ã€‚ã“ã®è¨˜äº‹ã§ã¯ã€MVVMã«åŠ ãˆã¦ã€Repositoryãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚Repositoryãƒ‘ã‚¿ãƒ¼ãƒ³ã¯ã€ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚„å¤–éƒ¨APIã®ã‚ˆã†ãªãƒ‡ãƒ¼ã‚¿ã‚½ãƒ¼ã‚¹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã‚’æŠ½è±¡åŒ–ã™ã‚‹ãŸã‚ã®ãƒ‡ã‚¶ã‚¤ãƒ³ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã™ã€‚è©³ã—ã„è§£èª¬ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã®è¨˜äº‹ã‚’è¦‹ãŸæ–¹ãŒã‚ã‹ã‚Šã‚„ã™ã„ã§ã™ã€‚

https://wasabeef.medium.com/flutter-%E3%82%92-mvvm-%E3%81%A7%E5%AE%9F%E8%A3%85%E3%81%99%E3%82%8B-861c5dbcc565


# ä»Šå›æ¡ç”¨ã—ã¦ã„ã‚‹ä¸»ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸

- hooks_riverpod
- flutter_hooks
- build_runner
- freezed
- auto_route
- device_preview

## Riverpod

Providerã§çŠ¶æ…‹ã‚’å®šç¾©ã—ã€StatelessWidgetã®ã‚ˆã†ãªçŠ¶æ…‹ã‚’æŒãŸãªã„ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã«å¯¾ã—ã¦ã€çŠ¶æ…‹ã‚’æ³¨å…¥ã§ãã‚‹ã‚ˆã†ã«ã—ãŸDIãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã®ã“ã¨ã§ã™ã€‚StatefullWidgetã¯ã€çŠ¶æ…‹ã¨ViewãŒçµåˆã—ã¦ã„ã‚‹ã®ã§ã€ã‚³ãƒ¼ãƒ‰ãŒå†—é•·ã«ãªã‚‹ã¨ã„ã†æ¬ ç‚¹ã‚’æŒã£ã¦ã„ã¾ã™ãŒï¼ˆä»–ã«ã‚‚è‰²ã€…æ¬ ç‚¹ãŒã‚ã‚Šã¾ã™ï¼‰ã€Riverpodã®ã‚ˆã†ãªDIãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ä½¿ç”¨ã™ã‚Œã°ã€Viewã¨çŠ¶æ…‹ã‚’åˆ†é›¢ã§ãã€ä¿å®ˆæ€§ã®å‘ä¸Šã«ã¤ãªãŒã‚Šã¾ã™ã€‚

https://riverpod.dev/

## Build Runner

ã‚³ãƒ¼ãƒ‰ã®ç”Ÿæˆã¨ã‹ã‚’ã‚³ãƒãƒ³ãƒ‰1ã¤ã§ã§ãã‚‹ã‚ˆã†ã«ã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚ä»Šå›ã¯ã€`Freezed`ã‚„`auto_route`ã€`flutter_gen`ãªã©ã§ã€ã‚³ãƒ¼ãƒ‰ç”Ÿæˆã‚’è¡Œã†ãŸã‚ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚

https://pub.dev/packages/build_runner

## Freezed

immutableãªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ç”Ÿæˆã—ã¦ãã‚Œã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚ã¾ãŸã€å†…éƒ¨ã§`json_serializable`ã‚’ä½¿ã£ã¦ã„ã‚‹ã®ã§ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¨jsonã®ç›¸äº’å¤‰æ›ã‚‚å¯¾å¿œã—ã¦ã„ã¾ã™ã€‚

https://pub.dev/packages/freezed

## Auto Route

ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°å‘¨ã‚Šã‚’ã„ã„æ„Ÿã˜ã«ã—ã¦ãã‚Œã‚‹ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚

https://pub.dev/packages/auto_route

## Device Preview

1ã¤ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ä¸Šã§ã€ã•ã¾ã–ã¾ãªç«¯æœ«ã®ã‚µã‚¤ã‚ºã‚’ç¢ºèªã—ãŸã‚Šã€ç«¯æœ«ã®è¨­å®šï¼ˆè¨€èªãƒ»ãƒ€ãƒ¼ã‚¯ãƒ†ãƒ¼ãƒãªã©ï¼‰ã‚’ã„ã˜ã‚Œã‚‹ã‚ˆã†ã«ã—ãŸãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã§ã™ã€‚ä»Šã¾ã§ã¯è¤‡æ•°ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã‚’ç”¨æ„ã—ã¦ç¢ºèªã—ã¦ã„ã¾ã—ãŸãŒã€ã“ã®ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ãˆã°ã€ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã®åˆ‡ã‚Šæ›¿ãˆãŒå¿…è¦ãªã„ã®ã§ã€é–‹ç™ºã‚¹ãƒ”ãƒ¼ãƒ‰ãŒæ ¼æ®µã«ä¸ŠãŒã‚Šã¾ã™ã€‚

https://pub.dev/packages/device_preview


# æœ¬é¡Œ

Flutter SDKã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ã€stableã§ã‚ã‚‹v2.8.1ï¼ˆ2021å¹´12æœˆ19æ—¥ç¾åœ¨ï¼‰ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

## Flutterã®é››å½¢ã‚¢ãƒ—ãƒªã‚’ä½œæˆ

```shell
$ flutter create flapp
$ cd flapp
$ flutter run
```

![](https://storage.googleapis.com/zenn-user-upload/0db519a4f47e-20211218.png)

## ã‚¨ãƒ‡ã‚£ã‚¿ã®è¨­å®š

ã‚³ãƒ¼ãƒ‰ã®çµ±ä¸€æ€§ã‚’é«˜ã‚ã‚‹ãŸã‚ã«ã€EditorConfigã‚’è¨­å®šã—ã¦ãŠãã¾ã™ã€‚ã“ã‚Œã‚’è¨­å®šã—ã¦ãŠãã“ã¨ã§ã€ã‚¤ãƒ³ãƒ‡ãƒ³ãƒˆã®ã‚µã‚¤ã‚ºãƒ»ã‚¹ã‚¿ã‚¤ãƒ«ã‚„æ–‡å­—ã‚³ãƒ¼ãƒ‰ãªã©ã€äººãã‚Œãã‚Œã«ãªã‚Šãã†ãªã‚‚ã®ã‚’æ—©ã‚ã«è¨­å®šã—ã¦ãŠãã“ã¨ã§ã€çµ±ä¸€æ„Ÿã®ã‚ã‚‹ã‚³ãƒ¼ãƒ‰ã‚’æ›¸ã‘ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ã“ã‚Œã¯æ˜¯éã¨ã‚‚è¨­å®šã—ã¦ãŠãã¾ã—ã‚‡ã†ã€‚

https://editorconfig.org/

```shell
$ touch .editorconfig
```

```txt:.editorconfig
root = true

[*]

indent_style = space
indent_size = 2

end_of_line = lf
charset = utf-8
trim_trailing_whitespace = true
insert_final_newline = true

[*.md]
trim_trailing_whitespace = false
```

## analysis_optionsã®è¨­å®š

Flutter2.5.0ã‹ã‚‰ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§`flutter_lints`ãŒå…¥ã£ã¦ãŠã‚Šã€ç‰¹ã«é›£ã—ã„è¨­å®šã„ã‚‰ãšã§é™çš„è§£æãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã¾ã™ã€‚

https://pub.dev/packages/flutter_lints

```shell
# ã‚³ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
$ fvm flutter analyze

# libãƒ•ã‚©ãƒ«ãƒ€ä»¥ä¸‹ã‚’ã‚³ãƒ¼ãƒ‰æ•´å½¢
$ fvm flutter format lib/
```

ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è¨­å®šã®ã¾ã¾ã§ã‚‚è‰¯ã„ã®ã§ã™ãŒã€ä¸€å¿œè‡ªåˆ†ãŒã„ã¤ã‚‚ä½¿ã£ã¦ã„ã‚‹ã‚‚ã®ã‚’è¨­å®šã—ã¦ãŠãã¾ã™ã€‚

```yaml:analysis_options.yaml
include: package:flutter_lints/flutter.yaml

analyzer:
  strong-mode:
    implicit-casts: true
    implicit-dynamic: true
  exclude:
    - "**/generated_plugin_registrant.dart"
    - "**/build/**"
    - "**/generated_*.dart"
    - "**/*.g.dart"
    - "**/*.freezed.dart"
    - "**/*.gr.dart"
    - "**/l10n*.dart"
    - "**/*.gen.dart"

linter:
  rules:
    - avoid_types_on_closure_parameters
    - avoid_void_async
    - await_only_futures
    - camel_case_types
    - cancel_subscriptions
    - close_sinks
    - constant_identifier_names
    - control_flow_in_finally
    - directives_ordering
    - empty_statements
    - hash_and_equals
    - implementation_imports
    - non_constant_identifier_names
    - package_api_docs
    - package_names
    - package_prefixed_library_names
    - test_types_in_equals
    - throw_in_finally
    - unnecessary_brace_in_string_interps
    - unnecessary_getters_setters
    - unnecessary_new
    - unnecessary_statements
    - prefer_const_constructors
```

## Prettierã®å°å…¥

Prettierã¯ã€ã„ã„æ„Ÿã˜ã«ã‚³ãƒ¼ãƒ‰æ•´å½¢ã‚’ã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚dartãƒ•ã‚¡ã‚¤ãƒ«ã¯ï¼ˆå¤šåˆ†ï¼‰Prettierã‚’ä½¿ãˆãªã„ã®ã§ã™ãŒã€ä»Šå›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯ã€jsonãƒ•ã‚¡ã‚¤ãƒ«ãªã©ãŒã‚ã‚Šã€ã“ã‚Œã‚‰ã®ã‚³ãƒ¼ãƒ‰ãŒãã¡ã‚ƒãã¡ã‚ƒãªã®ã¯å€‹äººçš„ã«ã¯è€ƒãˆã‚‰ã‚Œãªã„ã®ã§ã€è¨­å®šã—ã¦ãŠãã¾ã™ã€‚

https://prettier.io/

```shell
$ yarn init -y
$ yarn add -D prettier
$ touch .prettierrc .prettierignore
```

```json:.prettierrc
{
  "semi": false,
  "singleQuote": true,
  "tabWidth": 2,
  "useTabs": false
}
```

```txt:.prettierignore
.dart_tool
.fvm
build
ios
android
```

node_modulesãƒ•ã‚©ãƒ«ãƒ€ãŒä½œæˆã•ã‚Œã‚‹ã®ã§ã€.gitignoreã«è¿½åŠ ã—ã¾ã™ã€‚

```diff txt:.gitignore
+ node_modules
```

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ã€jsonãƒ»htmlãƒ»yamlãƒ•ã‚¡ã‚¤ãƒ«ãªã©ã‚’ã‚³ãƒ¼ãƒ‰æ•´å½¢ã—ã¦ãã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```shell
$ yarn prettier --write .
```

## Huskyãƒ»lint-stagedã®å°å…¥

Huskyã¨ã¯ã€ã‚³ãƒŸãƒƒãƒˆæ™‚ã‚„ãƒ—ãƒƒã‚·ãƒ¥æ™‚ãªã©ã«ä½•ã‚‰ã‹ã®å‡¦ç†ã‚’å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚
lint-stagedã¨ã¯ã€ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã—ã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã«å¯¾ã—ã¦ä½•ã‚‰ã‹ã®å‡¦ç†ã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

https://typicode.github.io/husky/#/

https://www.npmjs.com/package/lint-staged

ä»Šå›ã¯ã“ã‚Œã‚‰ã‚’åˆã‚ã›ã¦ã€ã‚³ãƒŸãƒƒãƒˆæ™‚ã«ã‚³ãƒ¼ãƒ‰æ•´å½¢ã‚’å®Ÿè£…ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```shell
$ yarn add -D husky lint-staged
$ npx husky-init && yarn install
```

npx husky-initã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€.husky/pre-commitãƒ•ã‚¡ã‚¤ãƒ«ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

package.jsonã«lint-stagedã®è¨­å®šã‚’è¿½åŠ ã—ã¾ã™ã€‚ä¸‹è¨˜ã¯ã€ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¦ã„ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ãŒdartã®å ´åˆã¯ã€fvm flutter formatã‚’å®Ÿè¡Œã—ã€jsonãƒ»yamlã®å ´åˆã¯ã€prettier --writeã‚’å®Ÿè¡Œã—ã¦ã„ã‚‹ä¾‹ã§ã™ã€‚

```diff json:package.json
{
+  "lint-staged": {
+    "*.dart": [
+      "fvm flutter format"
+    ],
+    "*.@(json|yaml)": [
+      "prettier --write"
+    ]
+  }
}
```

.husky/pre-commitã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ä¿®æ­£ã—ã¦ã€ã‚³ãƒŸãƒƒãƒˆæ™‚ã«lint-stagedã‚’å®Ÿè¡Œã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```diff shell:.husky/pre-commit
#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

- npm test
+ yarn lint-staged
```

## FVMã®è¨­å®š

FVMï¼ˆFlutter Version Managementï¼‰ã¨ã¯ã€Flutter SDKã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ç®¡ç†ã—ã¦ãã‚Œã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚å®Ÿéš›ã®é–‹ç™ºã§ã¯ã€Flutterã®SDKã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«ã‚ˆã£ã¦ã¯å‹•ã‹ãªã„ã¨ã„ã£ãŸã‚±ãƒ¼ã‚¹ãŒç™ºç”Ÿã—ã†ã‚‹ã®ã§ã€FVMã®è¨­å®šã¯å¿…ãšã¨ã„ã£ã¦ã„ã„ã»ã©ã‚„ã£ã¦ãŠã„ãŸæ–¹ãŒè‰¯ã„ã§ã™ã€‚

https://fvm.app/

fvmã‚³ãƒãƒ³ãƒ‰ãŒä½¿ãˆãªã„æ–¹ã¯ã€ã¾ãšä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

```shell
$ dart pub global activate fvm
$ fvm --version
2.2.4
```

fvmã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ã¾ã™ã€‚fvm_config.jsonã§ã¯ã€flutter SDKã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æŒ‡å®šã—ã¾ã™ã€‚

```shell
$ touch .fvm/fvm_config.json .fvm/.gitignore
$ fvm install
$ fvm flutter pub get
```

:::message alert
2021å¹´12æœˆ20æ—¥ç¾åœ¨ã€stableã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§ã‚ã‚‹2.8.1ã‚’ä½¿ç”¨ã™ã‚‹ã¨ã€`auto_route`ã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ã„ã‚‹ã®ã§ã€2.5.3ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’ä½¿ç”¨ã—ã¦ã„ã¾ã™ã€‚
:::

```json:.fvm/fvm_config.json
{
  "flutterSdkVersion": "2.5.3",
  "flavors": {}
}
```

```txt:.gitignore
*
!.gitignore
!fvm_config.json
```

:::message
åˆ©ç”¨å¯èƒ½ãªFlutter SDKã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã§ãã¾ã™ã€‚
:::

```shell
$ fvm releases
..
Oct 15 21  â”‚ 2.5.3
Oct 20 21  â”‚ 2.7.0-3.0.pre
Oct 28 21  â”‚ 2.7.0-3.1.pre
Nov 12 21  â”‚ 2.8.0-3.1.pre
Nov 18 21  â”‚ 2.8.0-3.2.pre
Dec 1 21   â”‚ 2.8.0-3.3.pre
Dec 9 21   â”‚ 2.8.0
--------------------------------------
Dec 15 21  â”‚ 2.9.0-0.1.pre     beta
--------------------------------------
--------------------------------------
Dec 15 21  â”‚ 2.9.0-0.1.pre     dev
--------------------------------------
--------------------------------------
Dec 16 21  â”‚ 2.8.1             stable
--------------------------------------
```

## main.dartã®ã‚¦ã‚£ã‚¸ã‚§ãƒƒãƒˆã‚’StatelessWidgetã«ç½®ãæ›ãˆã‚‹

ä»Šå›ã€StatefullWidgetã‚’ä½¿ã£ãŸçŠ¶æ…‹ç®¡ç†ã¯è¡Œã‚ãªã„ã®ã§ã€ä¸€æ—¦çŠ¶æ…‹ã‚’æŒãŸãªã„StatelessWidgetã«ç½®ãæ›ãˆã¾ã™ã€‚

:::message
çœŸã‚“ä¸­ã«ç”»åƒã‚’è¡¨ç¤ºã—ãŸã„ã®ã§ã€`assets/img`ãƒ•ã‚©ãƒ«ãƒ€ã‚’ä½œã£ã¦ã€ãã®ä¸­ã«flutter-icon.pngã‚’é…ç½®ã—ã¦ãã ã•ã„ã€‚
:::

```diff yaml:pubspec.yaml
flutter:
  uses-material-design: true
+ assets:
+   - assets/img/
```

```dart:lib/main.dart
import 'package:flutter/material.dart';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: const MyHomePage(),
    );
  }
}

class MyHomePage extends StatelessWidget {
  const MyHomePage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Image.asset(
              'assets/img/flutter-icon.png',
              width: 200,
            ),
            Text(
              'flapp',
              style: Theme.of(context).textTheme.headline4,
            ),
          ],
        ),
      ),
    );
  }
}
```

![](https://storage.googleapis.com/zenn-user-upload/6bf5120ec3e1-20211218.png)

## å¤šè¨€èªå¯¾å¿œ(l10n)ã®å°å…¥

å¤šè¨€èªå¯¾å¿œã‚’ã™ã‚‹ãŸã‚ã«intlã¨ã„ã†ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’å°å…¥ã—ã¾ã™ã€‚

https://pub.dev/packages/intl

```shell
$ fvm flutter pub add intl
```

```diff yaml:pubspec.yaml
dependencies:
  flutter:
    sdk: flutter
+  flutter_localizations:
+    sdk: flutter
  cupertino_icons: ^1.0.2
+  intl: ^0.17.0
```

genarateãƒ•ãƒ©ã‚°ã‚’trueã«ã—ã¦ãŠãã¾ã™ã€‚

```diff yaml:pubspec.yaml
flutter:
+ generate: true
  uses-material-design: true
  assets:
    - assets/img/
```

l10nã®è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```shell
$ touch l10n.yaml
```

```yaml:l10n.yaml
arb-dir: lib/l10n
template-arb-file: app_ja.arb
output-localization-file: l10n.dart
output-class: L10n
```

æ—¥æœ¬èªã®è¨€èªãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ ã—ã¾ã™ã€‚

```shell
$ touch lib/l10n/app_ja.arb
```

```arb:lib/l10n/app_ja.arb
{
  "@@locale": "ja",
  "hello": "ã“ã‚“ã«ã¡ã¯"
}
```

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€`.dart_tool/flutter_gen/gen_l10n/l10n.dart`ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

```shell
$ fvm flutter gen-l10n
```

main.dartã®MaterialAppã§localizationsDelegatesãƒ»supportedLocalesã‚’è¿½åŠ ã—ã¾ã™ã€‚

```diff dart:lib/main.dart
import 'package:flutter/material.dart';
+ import 'package:flutter_gen/gen_l10n/l10n.dart';

void main() {
  runApp(const MyApp());
}

class MyApp extends StatelessWidget {
  const MyApp({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
+     localizationsDelegates: L10n.localizationsDelegates,
+     supportedLocales: L10n.supportedLocales,
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: const MyHomePage(),
    );
  }
}

class MyHomePage extends StatelessWidget {
  const MyHomePage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Image.asset(
              'assets/img/flutter-icon.png',
              width: 200,
            ),
            Text(
-	      'flapp'
+             L10n.of(context)!.hello,
              style: Theme.of(context).textTheme.headline4,
            ),
          ],
        ),
      ),
    );
  }
}
```

ã“ã‚Œã§ã€arbãƒ•ã‚¡ã‚¤ãƒ«ã«å®šç¾©ã—ãŸæ–‡è¨€ãŒä½¿ç”¨ã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```dart
L10n.of(context)!.hello // ã“ã‚“ã«ã¡ã¯
```

![](https://storage.googleapis.com/zenn-user-upload/743f8d71701d-20211218.png)

## flutter_genã§ã‚¢ã‚»ãƒƒãƒˆç®¡ç†

å…ˆã»ã©ã€ç”»åƒã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ã—ã¦è¡¨ç¤ºã—ã¦ã„ãŸã‹ã¨æ€ã„ã¾ã™ã€‚ãŸã ãƒ‘ã‚¹ã«ã‚ˆã‚‹æŒ‡å®šã ã¨ã€typoãŒæ€–ã„ã®ã§ã€ã“ã‚Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«ã€`flutter_gen`ã‚’å°å…¥ã—ã¾ã™ã€‚

https://pub.dev/packages/flutter_gen

build_runnerã¨ä½µç”¨ã—ã¦ä½¿ã†ã®ã§ã€build_runnerã‚‚ä¸€ç·’ã«å°å…¥ã—ã¾ã™ã€‚ã¾ãŸã€svgã®å¯¾å¿œã‚‚ä¸€å¿œã‚„ã£ã¦ãŠãã¾ã™ã€‚

```shell
$ fvm flutter pub add build_runner -d
$ fvm flutter pub add flutter_gen_runner -d
$ fvm flutter pub add flutter_svg
```

```diff yaml:pubspec.yaml
flutter:
  generate: true
  uses-material-design: true
  assets:
    - assets/img/

+ flutter_gen:
+  integrations:
+    flutter_svg: true
```

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã€`lib/gen/assets.gen.dart`ãŒä½œæˆã•ã‚Œã¾ã™ã€‚

```shell
$ fvm flutter packages pub run build_runner build
```

main.dartã®ã‚¢ã‚»ãƒƒãƒˆã‚’`lib/gen/assets.gen.dart`ã®Assetsã‚¯ãƒ©ã‚¹ã‹ã‚‰å‘¼ã³å‡ºã—ã¾ã™ã€‚

```diff dart:lib/main.dart
+ import 'package:flapp/gen/assets.gen.dart';
import 'package:flutter/material.dart';
import 'package:flutter_gen/gen_l10n/l10n.dart';

class MyHomePage extends StatelessWidget {
  const MyHomePage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
-           Image.asset(
-             'assets/img/flutter-icon.png',
-             width: 200,
-           ),
+           Assets.img.flutterIcon.image(width: 200),
            Text(
              L10n.of(context)!.hello,
              style: Theme.of(context).textTheme.headline4,
            ),
          ],
        ),
      ),
    );
  }
}
```

## auto_routeã®å°å…¥

ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®å®Ÿè£…ã«ã¯ã€`auto_route`ã‚’ä½¿ç”¨ã—ã¾ã™ã€‚

https://pub.dev/packages/auto_route

:::message
ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã®å®Ÿè£…ã®å‰ã«ã€ä»Šã®main.dartãŒè‚¥å¤§åŒ–ã—ã¦ã„ã‚‹ã®ã§ã€`main.dart`ãƒ»`app.dart`ãƒ»`xxx_page.dart`ã«åˆ†å‰²ã—ã¾ã™ã€‚
:::

```shell
$ mkdir -p lib/ui/xxx
$ touch lib/app.dart lib/ui/xxx/xxx_page.dart
```

```dart:lib/main.dart
import 'package:flutter/material.dart';
import 'app.dart';

void main() {
  runApp(const MyApp());
}
```

```dart:lib/app.dart
import 'package:flapp/ui/xxx/xxx_page.dart';
import 'package:flutter/material.dart';
import 'package:flutter_gen/gen_l10n/l10n.dart';

class MyApp extends StatelessWidget {
  const MyApp({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Flutter Demo',
      localizationsDelegates: L10n.localizationsDelegates,
      supportedLocales: L10n.supportedLocales,
      theme: ThemeData(
        primarySwatch: Colors.blue,
      ),
      home: const XXXPage(),
    );
  }
}
```

```dart:lib/ui/xxx/xxx_page.dart
import 'package:flapp/gen/assets.gen.dart';
import 'package:flutter/material.dart';
import 'package:flutter_gen/gen_l10n/l10n.dart';

class XXXPage extends StatelessWidget {
  const XXXPage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Center(
        child: Column(
          mainAxisAlignment: MainAxisAlignment.center,
          children: [
            Assets.img.flutterIcon.image(width: 200),
            Text(
              L10n.of(context)!.hello,
              style: Theme.of(context).textTheme.headline4,
            ),
          ],
        ),
      ),
    );
  }
}
```

auto_routeã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```shell
$ fvm flutter pub add auto_route
$ fvm flutter pub add auto_route_generator -d
```

app_route.dartã¨route_path.dartã‚’ä½œæˆã—ã¾ã™ã€‚

```shell
$ mkdir -p lib/ui/routes
$ touch lib/ui/routes/app_route.dart lib/ui/routes/route_path.dart
```

```dart:lib/ui/routes/app_route.dart
import 'package:auto_route/auto_route.dart';
import 'package:flapp/ui/routes/route_path.dart';
import 'package:flapp/ui/xxx/xxx_page.dart';

@AdaptiveAutoRouter(
  replaceInRouteName: 'Page,Route',
  routes: [
    AutoRoute(
      path: RoutePath.appRouteXXX,
      page: XXXPage,
      initial: true,
    ),
  ],
)
class $AppRouter {}
```

```dart:lib/ui/routes/route_path.dart
class RoutePath {
  static const appRouteXXX = '/xxx';
}
```

:::message
`flutter_gen`ã®æ™‚ã¨åŒã˜ã§ã€`build_runner`ã‚’å®Ÿè¡Œã—ã¦ã‚ã’ã‚‹ã“ã¨ã§ã€`app_route.gr.dart`ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚
```shell
$ fvm flutter packages pub run build_runner build
```
:::

lib/app.dartã‚’ä¿®æ­£ã—ã¾ã™ã€‚

```diff dart:lib/app.dart
- import 'package:flapp/ui/xxx/xxx_page.dart';
+ import 'package:flapp/ui/routes/app_route.gr.dart';
import 'package:flutter/material.dart';
import 'package:flutter_gen/gen_l10n/l10n.dart';

class MyApp extends StatelessWidget {
  const MyApp({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context) {
+    final appRouter = AppRouter();
-    return MaterialApp(
-      title: 'Flutter Demo',
-      localizationsDelegates: L10n.localizationsDelegates,
-      supportedLocales: L10n.supportedLocales,
-      theme: ThemeData(
-        primarySwatch: Colors.blue,
-      ),
-      home: const XXXPage(),
-    );
+    return MaterialApp.router(
+      debugShowCheckedModeBanner: false,
+      theme: ThemeData(
+        primarySwatch: Colors.blue,
+      ),
+      localizationsDelegates: L10n.localizationsDelegates,
+      supportedLocales: L10n.supportedLocales,
+      routeInformationParser: appRouter.defaultRouteParser(),
+      routerDelegate: appRouter.delegate(),
+    );
  }
}
```

## Riverpodãƒ»Flutter Hooksã®å°å…¥

```shell
$ fvm flutter pub add hooks_riverpod
$ fvm flutter pub add flutter_hooks
```

main.dartã®`MyApp()`ã‚’`ProviderScope`ã§ãƒ©ãƒƒãƒ—ã—ã¾ã™ã€‚

```diff dart:lib/main.dart
import 'package:flutter/material.dart';
+ import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'app.dart';

void main() {
-  runApp(const MyApp());
+  runApp(const ProviderScope(child: MyApp()));
}
```

## Freezedã®å°å…¥

```shell
$ fvm flutter pub add freezed -d
$ fvm flutter pub add json_serializable
$ fvm flutter pub add freezed_annotation
```

è©¦ã—ã«xxxãƒšãƒ¼ã‚¸ã®çŠ¶æ…‹ã‚’freezedã‚’ç”¨ã„ã¦å®šç¾©ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

```shell
$ touch lib/ui/xxx/xxx_state.dart
```

```dart:lib/ui/xxx/xxx_state.dart
import 'package:freezed_annotation/freezed_annotation.dart';

part 'xxx_state.freezed.dart';

@freezed
class XXXState with _$XXXState {
  const factory XXXState({
    @Default(0) int count,
  }) = _XXXState;
}
```

:::message
ã“ã®æ™‚ã€xxx_state.dartã§ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã¨æ€ã„ã¾ã™ãŒã€ãã‚Œã¯æ­£å¸¸ã§ã™ã€‚
:::

freezedã‚‚build_runnerã‚’å®Ÿè¡Œã—ã¦ã‚ã’ã‚‹ã“ã¨ã§ã€`xxx_state.freezed.dart`ãŒè‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

```shell
$ fvm flutter packages pub run build_runner build
```

## ViewModelã®å®Ÿè£…

ä»Šå›ViewModelã¯ã€`StateNotifier`ã§å®Ÿè£…ã—ã¾ã™ã€‚`StateNotifier`ã¯ã‚·ãƒ³ã‚°ãƒ«ã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã‚’æŒã¡ã¾ã™ã€‚

```shell
$ touch lib/ui/xxx/xxx_view_model.dart
```

ä»¥ä¸‹ãŒViewModelã®å®Ÿè£…ã‚³ãƒ¼ãƒ‰ã§ã™ã€‚ä»Šå¾Œã€éåŒæœŸã®å€¤ã‚’æ‰±ã†ã“ã¨ã‚’è¦‹æ®ãˆã¦ã€ã‚·ãƒ³ã‚°ãƒ«ã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã¯ã€å…ˆã»ã©ä½œæˆã—ãŸ`XXXState`ã§ã¯ãªãã€`AsyncValue<XXXState>`ã¨ã—ã¦ã„ã¾ã™ã€‚

```dart:lib/ui/xxx/xxx_view_model.dart
import 'package:hooks_riverpod/hooks_riverpod.dart';

import 'xxx_state.dart';

final xxxViewModelProvider =
    StateNotifierProvider.autoDispose<XXXViewModel, AsyncValue<XXXState>>(
  (ref) => XXXViewModel(ref: ref),
);

class XXXViewModel extends StateNotifier<AsyncValue<XXXState>> {
  final AutoDisposeStateNotifierProviderRef _ref;
  XXXViewModel({required AutoDisposeStateNotifierProviderRef ref})
      : _ref = ref,
        super(const AsyncLoading()) {
    load();
  }

  // åˆæœŸåŒ–
  void load() {
    state = const AsyncValue.data(
      XXXState(count: 0),
    );
  }

  // ã‚«ã‚¦ãƒ³ãƒˆã‚’+1
  void increment() {
    final count = state.value!.count;
    state = AsyncValue.data(
      XXXState(count: count + 1),
    );
  }
}
```

å…ˆã»ã©ä½œæˆã—ãŸxxx_page.dartã‚’ä¿®æ­£ã—ã¾ã™ã€‚

```dart:lib/ui/xxx/xxx_page.dart
import 'package:flapp/gen/assets.gen.dart';
import 'package:flutter/material.dart';
import 'package:flutter_gen/gen_l10n/l10n.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

import 'xxx_view_model.dart';

class XXXPage extends HookConsumerWidget {
  const XXXPage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final state = ref.watch(xxxViewModelProvider);
    final viewModel = ref.watch(xxxViewModelProvider.notifier);

    return state.when(
      data: (data) {
        return Scaffold(
          body: SafeArea(
            child: Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Assets.img.flutterIcon.image(width: 200),
                  Text(
                    L10n.of(context)!.hello,
                    style: Theme.of(context).textTheme.headline4,
                  ),
                  ElevatedButton(
                    onPressed: viewModel.increment,
                    child: Text(data.count.toString()),
                  ),
                ],
              ),
            ),
          ),
        );
      },
      error: (e, msg) => Text(e.toString()),
      loading: () {
        return const Scaffold(
          body: SafeArea(
            child: Center(
              child: CircularProgressIndicator(),
            ),
          ),
        );
      },
    );
  }
}
```

XXXPageã¯`StatelessWidget`ã§å®Ÿè£…ã—ã¦ã„ã¾ã—ãŸãŒã€ViewModelã‚’æ³¨å…¥ï¼ˆDIï¼‰ã™ã‚‹ãŸã‚ã«`HookConsumerWidget`ã§ç½®ãæ›ãˆã¦ã„ã¾ã™ã€‚

ã‚·ãƒ³ã‚°ãƒ«ã‚½ãƒ¼ã‚¹ã®çŠ¶æ…‹ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚
```dart
final state = ref.watch(xxxViewModelProvider);
```

ViewModelã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹è‡ªä½“ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹ã¯ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã«ãªã‚Šã¾ã™ã€‚
```dart
final viewModel = ref.watch(xxxViewModelProvider.notifier);
```

ã¾ãŸã€çŠ¶æ…‹ã¯`AsyncValue`ãªã®ã§ã€ãã®ã¾ã¾ãƒ‡ãƒ¼ã‚¿ã‚’å–ã‚Šå‡ºã™ã“ã¨ãŒã§ãã¾ã›ã‚“ã€‚ãªã®ã§ã€whenãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ã£ã¦ã€æ­£å¸¸æ™‚ãƒ»ã‚¨ãƒ©ãƒ¼æ™‚ãƒ»ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ™‚ã®ãã‚Œãã‚Œã®å ´åˆã§å®Ÿè£…ã—ã¦ã‚ã’ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```dart
state.when(
  data: (data) {
    // æ­£å¸¸æ™‚
  },
  error: (e, msg) {
    // ã‚¨ãƒ©ãƒ¼æ™‚
  },
  loading: () {
    // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ™‚
  }
)
```

ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯ã™ã‚‹ã¨ã€ã‚«ã‚¦ãƒ³ãƒˆã‚¢ãƒƒãƒ—ã—ã¦ãã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚

![](https://storage.googleapis.com/zenn-user-upload/ad762210f153-20211218.png)

## Repositoryã®å®Ÿè£…

Repositoryã¯ä»Šå¾Œãƒ†ã‚¹ãƒˆã‚’æ›¸ãã“ã¨ã‚’è€ƒãˆã¦ã€æŠ½è±¡ã‚¯ãƒ©ã‚¹ã¨Implementã‚¯ãƒ©ã‚¹ã§æ§‹æˆã—ã¾ã™ã€‚

Repositoryã§ã¯ã€éåŒæœŸã®å€¤ã‚’æ‰±ã†ãŸã‚ã€æ­£å¸¸æ™‚ãƒ»ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒã—ã‚„ã™ã„ã‚ˆã†ã«ã€Resultã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚

:::message
AsyncValueã¨åŒã˜æ„Ÿã˜ã ã¨æ€ã£ã¦ã‚‚ã‚‰ã£ã¦å¤§ä¸ˆå¤«ã§ã™ã€‚
:::

```shell
$ mkdir -p lib/data/model/result
$ touch lib/data/model/result/result.dart
```

```dart:lib/data/model/result/result.dart
import 'package:freezed_annotation/freezed_annotation.dart';

part 'result.freezed.dart';

@freezed
abstract class Result<T> with _$Result<T> {
  const Result._();

  const factory Result.success({required T data}) = Success<T>;

  const factory Result.failure({required Exception error}) = Failure<T>;

  static Result<T> guard<T>(T Function() body) {
    try {
      return Result.success(data: body());
    } on Exception catch (e) {
      return Result.failure(error: e);
    }
  }

  static Future<Result<T>> guardFuture<T>(Future<T> Function() future) async {
    try {
      return Result.success(data: await future());
    } on Exception catch (e) {
      return Result.failure(error: e);
    }
  }

  bool get isSuccess => when(success: (data) => true, failure: (e) => false);

  bool get isFailure => !isSuccess;

  T get dataOrThrow {
    return when(
      success: (data) => data,
      failure: (e) => throw e,
    );
  }
}

extension ResultObjectExt<T> on T {
  Result<T> get asSuccess => Result.success(data: this);

  Result<T> asFailure(Exception e) => Result.failure(error: e);
}
```

fetché–¢æ•°ã‚’å‘¼ã³å‡ºã™ã¨ã€2ç§’å¾Œã«ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã‚’è¿”ã™`xxxRepository`ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

```shell
$ mkdir -p lib/data/repository/xxx
$ touch lib/data/repository/xxx/xxx_repository.dart
$ touch lib/data/repository/xxx/xxx_repository_impl.dart
```

æŠ½è±¡ã‚¯ãƒ©ã‚¹

```dart:lib/data/repository/xxx/xxx_repository.dart
import 'package:flapp/data/model/result/result.dart';

abstract class XXXRepository {
  Future<Result<int>> fetch();
}
```

å®Ÿè£…ã‚¯ãƒ©ã‚¹ï¼ˆImplementã‚¯ãƒ©ã‚¹ï¼‰

```dart:lib/data/repository/xxx/xxx_repository_impl.dart
import 'dart:math';

import 'package:flapp/data/model/result/result.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

import 'xxx_repository.dart';

final xxxRepositoryProvider =
    Provider<XXXRepository>((ref) => XXXRepositoryImpl(ref.read));

class XXXRepositoryImpl implements XXXRepository {
  XXXRepositoryImpl(this._reader);
  final Reader _reader;

  @override
  Future<Result<int>> fetch() async {
    return Result.guardFuture(() async {
      await Future.delayed(const Duration(seconds: 2)); // 2ç§’å¾…æ©Ÿ

      final rand = Random();
      return rand.nextInt(100); // 0~100ã®ä¹±æ•°
    });
  }
}
```

ViewModelå´ã§ã€xxxRepositoryã‚’å‘¼ã³å‡ºã—ã¾ã™ã€‚

```diff dart:lib/ui/xxx/xxx_view_model.dart
+ import 'package:flapp/data/repository/xxx/xxx_repository.dart';
+ import 'package:flapp/data/repository/xxx/xxx_repository_impl.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

import 'xxx_state.dart';

final xxxViewModelProvider =
    StateNotifierProvider.autoDispose<XXXViewModel, AsyncValue<XXXState>>(
  (ref) => XXXViewModel(ref: ref),
);

class XXXViewModel extends StateNotifier<AsyncValue<XXXState>> {
  final AutoDisposeStateNotifierProviderRef _ref;
  XXXViewModel({required AutoDisposeStateNotifierProviderRef ref})
      : _ref = ref,
        super(const AsyncLoading()) {
    load();
  }

+  // xxxRepository
+  late final XXXRepository xxxRepository = _ref.read(xxxRepositoryProvider);

  // åˆæœŸåŒ–
-  void load() {
-    state = const AsyncValue.data(
-      XXXState(count: 0),
-    );
-  }
+  Future<void> load() async {
+    final result = await xxxRepository.fetch();
+    result.when(
+      success: (data) {
+        state = AsyncValue.data(
+          XXXState(count: data),
+        );
+      },
+      failure: (error) {
+        state = AsyncValue.error(error);
+      },
+    );
+  }

  // ã‚«ã‚¦ãƒ³ãƒˆã‚’+1
  void increment() {
    final count = state.value!.count;
    state = AsyncValue.data(
      XXXState(count: count + 1),
    );
  }
}
```

2ç§’é–“ãƒ­ãƒ¼ãƒ‰ç”»é¢ãŒè¡¨ç¤ºã•ã‚ŒãŸå¾Œã«ã€ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°ãŒã‚»ãƒƒãƒˆã•ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

## ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ¼ãƒã®å®Ÿè£…

è‰²ã‚„ãƒ•ã‚©ãƒ³ãƒˆãªã©ã‚’è©³ç´°ã«è¨­å®šã—ã¦ã„ãã¾ã™ã€‚

ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒã¯ã€app_colors.dartã§å®šç¾©ã—ã¦ã„ãã¾ã™ã€‚

```shell
$ mkdir -p lib/ui/theme
$ touch lib/ui/theme/app_colors.dart
```

```dart:lib/ui/theme/app_colors.dart
import 'package:flutter/material.dart';

class AppColors {
  const AppColors({
    required this.primary,
    required this.primaryVariant,
    required this.onPrimary,
    required this.secondary,
    required this.secondaryVariant,
    required this.onSecondary,
    required this.background,
    required this.onBackground,
    required this.surface,
    required this.onSurface,
    required this.error,
    required this.onError,
  });

  factory AppColors.light() {
    return const AppColors(
      primary: Color(0xFF6200EE),
      primaryVariant: Color(0xFF3700B3),
      onPrimary: Color(0xFFFFFFFF),
      secondary: Color(0xFF03DAC6),
      secondaryVariant: Color(0xFF018786),
      onSecondary: Color(0xFF000000),
      background: Color(0xFFFFFFFF),
      onBackground: Color(0xFF000000),
      surface: Color(0xFFFFFFFF),
      onSurface: Color(0xFF000000),
      error: Color(0xFFB00020),
      onError: Color(0xFFFFFFFF),
    );
  }

  factory AppColors.dark() {
    return const AppColors(
      primary: Color(0xFF6200EE),
      primaryVariant: Color(0xFF3700B3),
      onPrimary: Color(0xFFFFFFFF),
      secondary: Color(0xFF03DAC6),
      secondaryVariant: Color(0xFF018786),
      onSecondary: Color(0xFF000000),
      background: Color(0xFFFFFFFF),
      onBackground: Color(0xFF000000),
      surface: Color(0xFFFFFFFF),
      onSurface: Color(0xFF000000),
      error: Color(0xFFB00020),
      onError: Color(0xFFFFFFFF),
    );
  }

  /// Material Colors https://material.io/design/color/the-color-system.html#color-theme-creation
  final Color primary;
  final Color primaryVariant;
  final Color onPrimary;
  final Color secondary;
  final Color secondaryVariant;
  final Color onSecondary;
  final Color background;
  final Color onBackground;
  final Color surface;
  final Color onSurface;
  final Color error;
  final Color onError;
}
```

:::message
è‰²ã®å®šç¾©ã¯ã€Material Designã«æº–æ‹ ã—ã¦ã„ã¾ã™ã€‚
https://material.io/design/color/the-color-system.html#color-theme-creation
:::

ãƒ†ã‚­ã‚¹ãƒˆãƒ†ãƒ¼ãƒã¯ã€`app_text_theme.dart`ã§å®šç¾©ã—ã¦ã„ãã¾ã™ã€‚

```shell
$ touch lib/ui/theme/app_text_theme.dart
$ touch lib/ui/theme/font_size.dart
```

```dart:lib/ui/theme/font_size.dart
class FontSize {
  /// 60pt
  static const double pt60 = 60;

  /// 48pt
  static const double pt48 = 48;

  /// 40pt
  static const double pt40 = 40;

  /// 32pt
  static const double pt32 = 32;

  /// 28pt
  static const double pt28 = 28;

  /// 24pt
  static const double pt24 = 24;

  /// 20pt
  static const double pt20 = 20;

  /// 18pt
  static const double pt18 = 18;

  /// 16pt
  static const double pt16 = 16;

  /// 14pt
  static const double pt14 = 14;

  /// 12pt
  static const double pt12 = 12;

  /// 10pt
  static const double pt10 = 10;

  /// 8pt
  static const double pt8 = 8;
}
```

ãƒ•ã‚©ãƒ³ãƒˆãƒ•ã‚¡ãƒŸãƒªãƒ¼ã®æŒ‡å®šã¯ã€GoogleFontã‚’ä½¿ç”¨ã™ã‚‹ã®ã§ã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¦ã„ãã¾ã™ã€‚ãƒ•ã‚©ãƒ³ãƒˆã¯ã€ŒNotoSansã€ã‚’æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

https://pub.dev/packages/google_fonts

```shell
$ fvm flutter pub add google_fonts
```

```dart:lib/ui/theme/app_text_theme.dart
import 'package:flutter/material.dart';
import 'package:google_fonts/google_fonts.dart';
import 'font_size.dart';

class AppTextTheme {
  const AppTextTheme._({
    required this.h10,
    required this.h20,
    required this.h30,
    required this.h40,
    required this.h50,
    required this.h60,
    required this.h70,
    required this.h80,
    required this.h90,
    required this.h100,
  });

  factory AppTextTheme() {
    final _normalRegular = GoogleFonts.notoSans(
      textStyle: const TextStyle(
        fontWeight: FontWeight.w400,
        height: 1.5,
        leadingDistribution: TextLeadingDistribution.even,
      ),
    );
    return AppTextTheme._(
      h10: const TextStyle(fontSize: FontSize.pt10).merge(_normalRegular),
      h20: const TextStyle(fontSize: FontSize.pt12).merge(_normalRegular),
      h30: const TextStyle(fontSize: FontSize.pt14).merge(_normalRegular),
      h40: const TextStyle(fontSize: FontSize.pt16).merge(_normalRegular),
      h50: const TextStyle(fontSize: FontSize.pt20).merge(_normalRegular),
      h60: const TextStyle(fontSize: FontSize.pt24).merge(_normalRegular),
      h70: const TextStyle(fontSize: FontSize.pt32).merge(_normalRegular),
      h80: const TextStyle(fontSize: FontSize.pt40).merge(_normalRegular),
      h90: const TextStyle(fontSize: FontSize.pt48).merge(_normalRegular),
      h100: const TextStyle(fontSize: FontSize.pt60).merge(_normalRegular),
    );
  }

  /// pt10
  final TextStyle h10;

  /// pt12
  final TextStyle h20;

  /// pt14
  final TextStyle h30;

  /// pt16
  final TextStyle h40;

  /// pt20
  final TextStyle h50;

  /// pt24
  final TextStyle h60;

  /// pt32
  final TextStyle h70;

  /// pt40
  final TextStyle h80;

  /// pt48
  final TextStyle h90;

  /// pt60
  final TextStyle h100;
}

extension TextStyleExt on TextStyle {
  TextStyle bold() => copyWith(fontWeight: FontWeight.w700);

  TextStyle comfort() => copyWith(height: 1.8);

  TextStyle dense() => copyWith(height: 1.2);
}
```

ã‚«ãƒ©ãƒ¼ãƒ†ãƒ¼ãƒã¨ãƒ†ã‚­ã‚¹ãƒˆãƒ†ãƒ¼ãƒã‚’1ã¤ã«ã¾ã¨ã‚ãŸAppThemeã‚¯ãƒ©ã‚¹ã‚’å®Ÿè£…ã—ã¾ã™ã€‚

```shell
$ touch lib/ui/theme/app_theme.dart
```

```dart:lib/ui/theme/app_theme.dart
import 'package:flutter/material.dart';
import 'package:google_fonts/google_fonts.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

import 'app_colors.dart';
import 'app_text_theme.dart';

final appThemeModeProvider =
    StateNotifierProvider<StateController<ThemeMode>, ThemeMode>(
  (ref) => StateController(ThemeMode.light),
);

final appThemeProvider = Provider<AppTheme>(
  (ref) {
    final mode = ref.watch(appThemeModeProvider);
    switch (mode) {
      case ThemeMode.dark:
        return AppTheme.dark();
      case ThemeMode.light:
      default:
        return AppTheme.light();
    }
  },
);

class AppTheme {
  AppTheme({
    required this.mode,
    required this.data,
    required this.textTheme,
    required this.appColors,
  });

  factory AppTheme.light() {
    const mode = ThemeMode.light;
    final appColors = AppColors.light();
    final themeData = ThemeData.light().copyWith(
      scaffoldBackgroundColor: appColors.background,
      textTheme: GoogleFonts.notoSansTextTheme(ThemeData.light().textTheme),
      snackBarTheme: SnackBarThemeData(
        backgroundColor: appColors.error,
        behavior: SnackBarBehavior.floating,
      ),
    );
    return AppTheme(
      mode: mode,
      data: themeData,
      textTheme: AppTextTheme(),
      appColors: appColors,
    );
  }

  factory AppTheme.dark() {
    const mode = ThemeMode.dark;
    final appColors = AppColors.dark();
    final themeData = ThemeData.dark().copyWith(
      scaffoldBackgroundColor: appColors.background,
      textTheme: GoogleFonts.notoSansTextTheme(ThemeData.dark().textTheme),
      snackBarTheme: SnackBarThemeData(
        backgroundColor: appColors.error,
        behavior: SnackBarBehavior.floating,
      ),
    );
    return AppTheme(
      mode: mode,
      data: themeData,
      textTheme: AppTextTheme(),
      appColors: appColors,
    );
  }

  final ThemeMode mode;
  final ThemeData data;
  final AppTextTheme textTheme;
  final AppColors appColors;
}
```

æœ€å¾Œã«ã€å…ˆã»ã©ä½œæˆã—ãŸã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ¼ãƒã‚’app.dartã«é©ç”¨ã—ã¦ã„ãã¾ã™ã€‚ã‚«ã‚¹ã‚¿ãƒ ãƒ†ãƒ¼ãƒã¯Providerã§å®šç¾©ã—ã¦ã„ã‚‹ã®ã§ã€app.dartã®`StatelessWidget`ã‚’`HookConsumerWidget`ã«å¤‰æ›´ã—ã¾ã™ã€‚

```diff dart:lib/app.dart
import 'package:flapp/ui/routes/app_route.gr.dart';
+ import 'package:flapp/ui/theme/app_theme.dart';
import 'package:flutter/material.dart';
import 'package:flutter_gen/gen_l10n/l10n.dart';
+ import 'package:flutter_hooks/flutter_hooks.dart';
+ import 'package:hooks_riverpod/hooks_riverpod.dart';

- class MyApp extends StatelessWidget {
+ class MyApp extends HookConsumerWidget {
  const MyApp({Key? key}) : super(key: key);

  @override
-  Widget build(BuildContext context) {
+  Widget build(BuildContext context, WidgetRef ref) {
+    final theme = ref.watch(appThemeProvider);
+    final themeMode = ref.watch(appThemeModeProvider);
-    final appRouter = AppRouter();
+    final appRouter = useMemoized(() => AppRouter());

    return MaterialApp.router(
      debugShowCheckedModeBanner: false,
+      theme: theme.data,
+      darkTheme: AppTheme.dark().data,
+      themeMode: themeMode,
      localizationsDelegates: L10n.localizationsDelegates,
      supportedLocales: L10n.supportedLocales,
      routeInformationParser: appRouter.defaultRouteParser(),
      routerDelegate: appRouter.delegate(),
    );
  }
}
```

:::message
ã¤ã„ã§ã«ã€AppRouterã‚’useMemoizedã§ãƒ¡ãƒ¢åŒ–ã—ã¦ã„ã¾ã™ã€‚
:::

AppThemeã‚’ä½¿ã£ã¦ã€xxxãƒšãƒ¼ã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ«ã‚’æ•´ãˆã¦ã„ãã¾ã™ã€‚

```diff dart:lib/ui/xxx/xxx_page.dart
import 'package:flapp/gen/assets.gen.dart';
+ import 'package:flapp/ui/theme/app_text_theme.dart';
+ import 'package:flapp/ui/theme/app_theme.dart';
import 'package:flutter/material.dart';
import 'package:flutter_gen/gen_l10n/l10n.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

import 'xxx_view_model.dart';

class XXXPage extends HookConsumerWidget {
  const XXXPage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context, WidgetRef ref) {
+   final theme = ref.watch(appThemeProvider);
+   final state = ref.watch(xxxViewModelProvider);
    final viewModel = ref.watch(xxxViewModelProvider.notifier);

    return state.when(
      data: (data) {
        return Scaffold(
          body: SafeArea(
            child: Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Assets.img.flutterIcon.image(width: 200),
                  Text(
                    L10n.of(context)!.hello,
+                   style: theme.textTheme.h70.bold(),
                  ),
                  ElevatedButton(
+                   style: ElevatedButton.styleFrom(
+                     primary: theme.appColors.primary,
+                     onPrimary: theme.appColors.onPrimary,
+                   ),
                    onPressed: viewModel.increment,
                    child: Text(data.count.toString()),
                  ),
                ],
              ),
            ),
          ),
        );
      },
      error: (e, msg) => Text(e.toString()),
      loading: () {
        return Scaffold(
          body: SafeArea(
            child: Center(
              child: CircularProgressIndicator(
+               color: theme.appColors.primary,
              ),
            ),
          ),
        );
      },
    );
  }
}
```

![](https://storage.googleapis.com/zenn-user-upload/d2b37583b723-20211219.png)

ãƒ†ã‚­ã‚¹ãƒˆã®ã‚¹ã‚¿ã‚¤ãƒ«ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«æŒ‡å®šã—ã¦ã„ã¾ã™ã€‚

```dart
Text(
  L10n.of(context)!.hello,
  style: theme.textTheme.h70.bold(),
),
```

è‰²ã¨ã‹ã‚’å¤‰æ›´ã—ãŸã„å ´åˆã¯ã€`copyWith`ã‚’ä½¿ã„ã¾ã™ã€‚

```dart
Text(
  L10n.of(context)!.hello,
  style: theme.textTheme.h70
              .bold()
              .copyWith(color: theme.appColors.onSecondary),
),
```

## ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã®å®Ÿè£…

l10nã‚’ä½¿ç”¨ã™ã‚‹ã¨ãã€ã“ã‚“ãªæ„Ÿã˜ã§contextã‚’æ¸¡ã—ã¦ã„ãŸã¨æ€ã„ã¾ã™ã€‚

```dart
L10n.of(context)!.hello // ã“ã‚“ã«ã¡ã¯
```

flutter_hooksã«ã¯ã€`useContext`ã¨ã„ã†hooké–¢æ•°ãŒç”¨æ„ã•ã‚Œã¦ã„ã¾ã™ã€‚ä»Šå›ã¯`useContext`ã‚’åˆ©ç”¨ã—ã¦ã€l10nã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹hooké–¢æ•°ã‚’å®Ÿè£…ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

```shell
$ mkdir -p lib/ui/hooks
$ touch lib/ui/hooks/use_l10n.dart
```

```dart:lib/ui/hooks/use_l10n.dart
import 'package:flutter_gen/gen_l10n/l10n.dart';
import 'package:flutter_hooks/flutter_hooks.dart';

L10n useL10n() {
  final context = useContext();
  return L10n.of(context)!;
}
```

å‘¼ã³å‡ºã—å´ã¯ã€ã“ã‚“ãªæ„Ÿã˜ã§contextã‚’æ¸¡ã™ã“ã¨ãªãã€l10nã«ã‚¢ã‚¯ã‚»ã‚¹ã§ãã¾ã™ã€‚

```dart
final l10n = useL10n();
l10n.hello // ã“ã‚“ã«ã¡ã¯
```

```diff dart:lib/ui/xxx/xxx_page.dart
import 'package:flapp/gen/assets.gen.dart';
+ import 'package:flapp/ui/hooks/use_l10n.dart';
import 'package:flapp/ui/theme/app_text_theme.dart';
import 'package:flapp/ui/theme/app_theme.dart';
import 'package:flutter/material.dart';
- import 'package:flutter_gen/gen_l10n/l10n.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

import 'xxx_view_model.dart';

class XXXPage extends HookConsumerWidget {
  const XXXPage({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final theme = ref.watch(appThemeProvider);
    final state = ref.watch(xxxViewModelProvider);
    final viewModel = ref.watch(xxxViewModelProvider.notifier);
+   final l10n = useL10n();

    return state.when(
      data: (data) {
        return Scaffold(
          body: SafeArea(
            child: Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Assets.img.flutterIcon.image(width: 200),
                  Text(
-		    L10n.of(context)!.hello,
+                   l10n.hello,
                    style: theme.textTheme.h70.bold(),
                  ),
                  ElevatedButton(
                    style: ElevatedButton.styleFrom(
                      primary: theme.appColors.primary,
                      onPrimary: theme.appColors.onPrimary,
                    ),
                    onPressed: viewModel.increment,
                    child: Text(data.count.toString()),
                  ),
                ],
              ),
            ),
          ),
        );
      },
      // çœç•¥
    );
  }
}
```

:::message alert
hooksé–¢æ•°ã¯ã€HookConsumerWidgetã®buildé–¢æ•°ã®ç›´ä¸‹ã§ã—ã‹ä½¿ãˆãªã„ã®ã§ã€æ³¨æ„ãŒå¿…è¦ã§ã™
:::

åŒæ§˜ã«ã€Routerã¨MediaQueryç”¨ã®hooké–¢æ•°ã‚’å®Ÿè£…ã—ã¦ãŠãã¾ã™ã€‚

```dart:lib/ui/hooks/use_router.dart
import 'package:auto_route/auto_route.dart';
import 'package:flutter_hooks/flutter_hooks.dart';

StackRouter useRouter() {
  final context = useContext();
  return AutoRouter.of(context);
}
```

```dart:lib/ui/hooks/use_media_query.dart
import 'package:flutter/material.dart';
import 'package:flutter_hooks/flutter_hooks.dart';

MediaQueryData useMediaQuery() {
  final context = useContext();
  return MediaQuery.of(context);
}
```

## Sizerã®å°å…¥

Flutterã§ä½œæˆã—ãŸã‚¢ãƒ—ãƒªã¯ã€ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ãƒ»ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆãƒ»PCãªã©ã€ã•ã¾ã–ã¾ãªç«¯æœ«ã§ä½¿ã‚ã‚Œã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ã®ã§ã€ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã«å¯¾å¿œã•ã›ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ãã“ã§ã€`Sizer`ã¨ã„ã†ãƒ—ãƒ©ã‚°ã‚¤ãƒ³ã‚’ä½¿ç”¨ã™ã‚Œã°ã€ç°¡å˜ã«ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–åŒ–ã•ã›ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚è©³ã—ã„ä½¿ã„æ–¹ã«ã¤ã„ã¦ã¯ã€ä»¥ä¸‹ã‚’ã”å‚ç…§ãã ã•ã„ã€‚

https://pub.dev/packages/sizer

```shell
$ fvm flutter pub add sizer
```

```diff dart:lib/app.dart
import 'package:flapp/ui/routes/app_route.gr.dart';
import 'package:flapp/ui/theme/app_theme.dart';
import 'package:flutter/material.dart';
import 'package:flutter_gen/gen_l10n/l10n.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
+ import 'package:sizer/sizer.dart';

class MyApp extends HookConsumerWidget {
  const MyApp({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final theme = ref.watch(appThemeProvider);
    final themeMode = ref.watch(appThemeModeProvider);
    final appRouter = useMemoized(() => AppRouter());

-    return MaterialApp.router(
-      debugShowCheckedModeBanner: false,
-      theme: theme.data,
-      darkTheme: AppTheme.dark().data,
-      themeMode: themeMode,
-      localizationsDelegates: L10n.localizationsDelegates,
-      supportedLocales: L10n.supportedLocales,
-      routeInformationParser: appRouter.defaultRouteParser(),
-      routerDelegate: appRouter.delegate(),
-    );
+    return Sizer(
+      builder: (context, orientation, deviceType) => MaterialApp.router(
+        debugShowCheckedModeBanner: false,
+        theme: theme.data,
+        darkTheme: AppTheme.dark().data,
+        themeMode: themeMode,
+        localizationsDelegates: L10n.localizationsDelegates,
+        supportedLocales: L10n.supportedLocales,
+        routeInformationParser: appRouter.defaultRouteParser(),
+        routerDelegate: appRouter.delegate(),
+      ),
+    );
  }
}
```

## Fimberã®å°å…¥

Fimberã¯ã€ãƒ­ã‚®ãƒ³ã‚°ç”¨ã®ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã«ãªã‚Šã¾ã™ã€‚ãƒªãƒªãƒ¼ã‚¹ç’°å¢ƒã§ã¯ã€ãƒ­ã‚°ã‚’å‚ã‚Œæµã—ã«ã™ã‚‹ã®ã¯ã€ã‚ˆããªã„ã®ã§ã€Fimberã®è¨­å®šã§ã€ãƒ‡ãƒãƒƒã‚°ç’°å¢ƒã§ã®ã¿ãƒ­ã‚°ã‚’æµã™ã‚ˆã†ã«ã—ã¾ã™ã€‚

https://pub.dev/packages/fimber

```shell
$ fvm flutter pub add fimber -d
```

```diff dart:lib/main.dart
+ import 'package:fimber/fimber.dart';
+ import 'package:flutter/foundation.dart';
import 'package:flutter/material.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

import 'app.dart';

void main() {
+  // Fimber
+  if (!kReleaseMode) {
+    Fimber.plantTree(DebugTree());
+  } else {
+    debugPrint = (message, {wrapWidth}) {};
+  }

  runApp(const ProviderScope(child: MyApp()));
}
```

ã¾ãŸã€`runZonedGuarded`ã§ã‚¢ãƒ—ãƒªå†…ã§ç™ºç”Ÿã—ãŸã‚¨ãƒ©ãƒ¼ã‚’æ•æ‰ã™ã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚æœ¬å½“ã¯ã€`Firebase Crashlytics`ã¨ã‹ã‚’ä½¿ã£ã¦ã€ã‚¯ãƒ©ãƒƒã‚·ãƒ¥ãƒ¬ãƒãƒ¼ãƒˆã‚’é€ã£ãŸæ–¹ãŒè‰¯ã„ã§ã™ãŒã€ä»Šå›ã¯Fimberã§ãƒ­ã‚°ã‚’å‡ºåŠ›ã™ã‚‹ã‚ˆã†ã«ã—ã¦ãŠãã¾ã™ã€‚

```diff dart:lib/main.dart
+ import 'dart:async';

import 'package:fimber/fimber.dart';
import 'package:flutter/foundation.dart';
import 'package:flutter/material.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

import 'app.dart';

void main() {
  // Fimber
  if (!kReleaseMode) {
    Fimber.plantTree(DebugTree());
  } else {
    debugPrint = (message, {wrapWidth}) {};
  }

-  runApp(const ProviderScope(child: MyApp()));
+  runZonedGuarded(
+    () => runApp(const ProviderScope(child: MyApp())),
+    (error, stackTrace) {
+      Fimber.e(error.toString());
+    },
+  );
}
```

## ç’°å¢ƒå¤‰æ•°ã®å®Ÿè£…

Flutter 1.17ã‹ã‚‰ã€ç’°å¢ƒå¤‰æ•°ã‚’`--dart-define`ã¨ã„ã†ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æ¸¡ã›ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚ä»Šå›ã¯ã€`FLAVOR`ã¨ã„ã†ç’°å¢ƒå¤‰æ•°ã‚’æ¸¡ã™ã‚ˆã†ã«ã—ã€é–‹ç™ºç’°å¢ƒï¼ˆdevï¼‰ã¨æœ¬ç•ªç’°å¢ƒ(prod)ã§ã‚¢ãƒ—ãƒªå†…ã®ç’°å¢ƒå¤‰æ•°ã‚’åˆ‡ã‚Šæ›¿ãˆã§ãã‚‹ã‚ˆã†ã«ã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚

https://itnext.io/flutter-1-17-no-more-flavors-no-more-ios-schemas-command-argument-that-solves-everything-8b145ed4285d

ã¾ãŸã€enumã¨Stringã®ç›¸äº’å¤‰æ›ã‚’è¡Œã†ãŸã‚ã€`enum_to_string`ã‚’å°å…¥ã—ã¦ã„ã¾ã™ã€‚

https://pub.dev/packages/enum_to_string

```shell
$ fvm flutter pub add enum_to_string
$ mkdir -p lib/foundation
$ touch lib/foundation/constants.dart
```

```dart:lib/foundation/constants.dart
import 'package:enum_to_string/enum_to_string.dart';

enum Flavor { dev, prod }

class Constants {
  const Constants._({required this.baseUrl});

  factory Constants.of() {
    switch (flavor) {
      case Flavor.dev:
        return Constants._dev();
      case Flavor.prod:
      default:
        return Constants._prod();
    }
  }

  factory Constants._dev() {
    return const Constants._(baseUrl: 'http://dev');
  }

  factory Constants._prod() {
    return const Constants._(baseUrl: 'http://prod');
  }

  /// ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
  final String baseUrl;

  /// ç’°å¢ƒ Flavor
  static Flavor get flavor =>
      EnumToString.fromString(
        Flavor.values,
        const String.fromEnvironment('FLAVOR'),
      ) ??
      Flavor.dev;
}
```

èµ·å‹•ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã«`--dart-define=FLAVOR=`ã‚’æ¸¡ã™ã ã‘ã§ã€ç’°å¢ƒå¤‰æ•°ã®åˆ‡ã‚Šæ›¿ãˆãŒã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã—ãŸã€‚æŒ‡å®šã—ãªã„å ´åˆã¯ã€devç’°å¢ƒã«ãªã‚Šã¾ã™ã€‚

```shell
# é–‹ç™ºç’°å¢ƒ(dev)
$ fvm flutter run --dart-define=FLAVOR=dev --target lib/main.dart

# æœ¬ç•ªç’°å¢ƒ(prod)
$ fvm flutter run --dart-define=FLAVOR=prod --target lib/main.dart
```

é–‹ç™ºç’°å¢ƒã®æ™‚ã¯ã€ã‚ã‹ã‚Šã‚„ã™ã„ã‚ˆã†ã«toastã‚’è¡¨ç¤ºã—ãŸã„ã¨æ€ã„ã¾ã™ã€‚toastè¡¨ç¤ºã¯ã€`fluttertoast`ã‚’å°å…¥ã—ã¾ã™ã€‚

```shell
$ fvm flutter pub add fluttertoast
```

```diff dart:lib/main.dart
import 'dart:async';

+ import 'package:enum_to_string/enum_to_string.dart';
import 'package:fimber/fimber.dart';
+ import 'package:flapp/foundation/constants.dart';
import 'package:flutter/foundation.dart';
import 'package:flutter/material.dart';
import 'package:fluttertoast/fluttertoast.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

import 'app.dart';

- void main() {
+ Future<void> main() async {
+  WidgetsFlutterBinding.ensureInitialized();

  // Fimber
  if (!kReleaseMode) {
    Fimber.plantTree(DebugTree());
  } else {
    debugPrint = (message, {wrapWidth}) {};
  }

+  // Display Toast (Only Dev)
+  if (Constants.flavor == Flavor.dev) {
+    Fluttertoast.showToast(
+      msg: "flavor: ${EnumToString.convertToString(Constants.flavor)}",
+    );
+  }

  runZonedGuarded(
    () => runApp(const ProviderScope(child: MyApp())),
    (error, stackTrace) {
      Fimber.e(error.toString());
    },
  );
}
```

:::message alert
`WidgetsFlutterBinding.ensureInitialized();`ãŒãªã„ã¨ã€ToastãŒã†ã¾ãè¡¨ç¤ºã•ã‚Œãªã„ã®ã§ã€è¨˜è¿°ã—ã¦ã„ã¾ã™ã€‚
https://api.flutter.dev/flutter/widgets/WidgetsFlutterBinding/ensureInitialized.html
:::

![](https://storage.googleapis.com/zenn-user-upload/c39e68bcc859-20211219.png)

## Device Previewã®å°å…¥

`Device Preview`ã¯ã€è¤‡æ•°ã®ãƒ‡ãƒã‚¤ã‚¹ã®ç”»é¢ã‚µã‚¤ã‚ºã‚’1ã¤ã®ã‚¨ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ã§ç¢ºèªã§ãã‚‹ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚ãƒ‡ãƒã‚¤ã‚¹ã®åˆ‡ã‚Šæ›¿ãˆã ã‘ã§ãªãã€è¨€èªã‚„ãƒ€ãƒ¼ã‚¯ãƒ¢ãƒ¼ãƒ‰ãªã©ã®è¨­å®šãŒã§ãã‚‹ã®ã§ã€éå¸¸ã«ç´ æ™´ã‚‰ã—ã„ãƒ„ãƒ¼ãƒ«ã§ã™ã€‚

https://pub.dev/packages/device_preview

```shell
$ fvm flutter pub add device_preview
```

Device Previewã®è¨­å®šã‚’ã—ã¾ã™ã€‚ãƒªãƒªãƒ¼ã‚¹ãƒ¢ãƒ¼ãƒ‰æ™‚ã¯ã€Device Previewã‚’ç„¡åŠ¹ã«ã—ã¾ã™ã€‚

```diff dart:lib/main.dart
import 'dart:async';

+ import 'package:device_preview/device_preview.dart';
import 'package:enum_to_string/enum_to_string.dart';
import 'package:fimber/fimber.dart';
import 'package:flapp/foundation/constants.dart';
import 'package:flutter/foundation.dart';
import 'package:flutter/material.dart';
import 'package:fluttertoast/fluttertoast.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

import 'app.dart';

Future<void> main() async {
  // çœç•¥
  runZonedGuarded(
-    () => runApp(const ProviderScope(child: MyApp())),
+    () => runApp(
+      ProviderScope(
+        child: DevicePreview(
+          enabled: !kReleaseMode,
+          builder: (context) {
+            return const MyApp();
+          },
+        ),
+      ),
+    ),
    (error, stackTrace) {
      Fimber.e(error.toString());
    },
  );
}
```

è¨€èªã®è¨­å®š(locale)ã‚„MediaQueryã‚’DevicePreviewã‹ã‚‰å¼•ãç¶™ãè¨­å®šã‚‚ã—ã¾ã™ã€‚

```diff dart:lib/app.dart
+ import 'package:device_preview/device_preview.dart';
import 'package:flapp/ui/routes/app_route.gr.dart';
import 'package:flapp/ui/theme/app_theme.dart';
import 'package:flutter/material.dart';
import 'package:flutter_gen/gen_l10n/l10n.dart';
import 'package:flutter_hooks/flutter_hooks.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';
import 'package:sizer/sizer.dart';

class MyApp extends HookConsumerWidget {
  const MyApp({Key? key}) : super(key: key);

  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final theme = ref.watch(appThemeProvider);
    final themeMode = ref.watch(appThemeModeProvider);
    final appRouter = useMemoized(() => AppRouter());

    return Sizer(
      builder: (context, orientation, deviceType) => MaterialApp.router(
        debugShowCheckedModeBanner: false,
+        useInheritedMediaQuery: true,
        theme: theme.data,
        darkTheme: AppTheme.dark().data,
        themeMode: themeMode,
+        locale: DevicePreview.locale(context),
        localizationsDelegates: L10n.localizationsDelegates,
        supportedLocales: L10n.supportedLocales,
        routeInformationParser: appRouter.defaultRouteParser(),
        routerDelegate: appRouter.delegate(),
      ),
    );
  }
}
```

![](https://storage.googleapis.com/zenn-user-upload/bea3fb19e69c-20211219.png)

:::message
ã‚¿ãƒ–ãƒ¬ãƒƒãƒˆç«¯æœ«ã§è¦‹ã‚‹ã¨ã€ã„ã„æ„Ÿã˜ã«è¡¨ç¤ºã•ã‚Œã¾ã™ã€‚
:::

å…ˆã»ã©ä½¿ç”¨ã—ãŸã€`--dart-define`ã§Device Previewã®æœ‰åŠ¹ã«ã™ã‚‹ã‹ã©ã†ã‹ã®åˆ¶å¾¡ãŒã§ãã‚‹ã‚ˆã†ã«ã—ã¾ã™ã€‚

```diff dart:lib/foundation/constants.dart
import 'package:enum_to_string/enum_to_string.dart';

enum Flavor { dev, prod }

class Constants {
  // çœç•¥

+  /// Device Previewã‚’æœ‰åŠ¹åŒ–ã™ã‚‹ã‹ã©ã†ã‹
+  static bool get enablePreview => const bool.fromEnvironment('PREVIEW');
}
```

```diff dart:lib/main.dart
import 'dart:async';

import 'package:device_preview/device_preview.dart';
import 'package:enum_to_string/enum_to_string.dart';
import 'package:fimber/fimber.dart';
import 'package:flapp/foundation/constants.dart';
import 'package:flutter/foundation.dart';
import 'package:flutter/material.dart';
import 'package:fluttertoast/fluttertoast.dart';
import 'package:hooks_riverpod/hooks_riverpod.dart';

import 'app.dart';

Future<void> main() async {
  // çœç•¥

  runZonedGuarded(
    () => runApp(
      ProviderScope(
        child: DevicePreview(
-          enabled: !kReleaseMode,
+          enabled: !kReleaseMode && Constants.enablePreview,
          builder: (context) {
            return const MyApp();
          },
        ),
      ),
    ),
    (error, stackTrace) {
      Fimber.e(error.toString());
    },
  );
}
```

`--dart-define=PREVIEW=true`ã‚’æ¸¡ã™ã¨ã€Device PreviewãŒæœ‰åŠ¹åŒ–ã«ãªã‚Šã¾ã™ã€‚

```shell
$ fvm flutter run --dart-define=FLAVOR=dev --dart-define=PREVIEW=true --target lib/main.dart
```

## Makefileã§ã‚ˆãä½¿ã†ã‚·ãƒ§ãƒƒãƒˆã‚«ãƒƒãƒˆã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè£…

Makefileã‚’ä½œæˆã™ã‚‹ã¨ã€shellã‚³ãƒãƒ³ãƒ‰ã‚’makeã‚³ãƒãƒ³ãƒ‰ã¨ã„ã†å½¢ã§è‡ªåˆ†ã§ä½œæˆã§ãã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚ä¾‹ãˆã°ã€`fvm flutter format lib`ã‚’`make format`ã§å®Ÿè¡Œã§ãã‚‹ã‚ˆã†ã«ã§ãã¾ã™ã€‚

```shell
$ touch Makefile
```

ä¸‹è¨˜ã¯ã€è‡ªåˆ†ãŒFlutterã‚’ã‚„ã‚‹ã¨ãã«ã„ã¤ã‚‚ä½¿ã£ã¦ã„ã‚‹Makefileã«ãªã‚Šã¾ã™ã€‚

```txt:Makefile
################################################################################################
## ç’°å¢ƒå¤‰æ•° flavor
################################################################################################
DEV_FLAVOR := dev
PROD_FLAVOR := prod


################################################################################################
## åŸºæœ¬ã‚³ãƒãƒ³ãƒ‰
################################################################################################
# setup
.PHONY: setup
setup:
	dart pub global activate fvm
	fvm install
	yarn install

# packages install
.PHONY: dependencies
dependencies:
	fvm flutter pub get

# packages upgrade
.PHONY: upgrade
upgrade:
	fvm flutter packages upgrade

# packages clean
.PHONY: clean
clean:
	fvm flutter clean

# code format
.PHONY: format
format:
	fvm flutter format lib/

# code analyze
.PHONY: analyze
analyze:
	fvm flutter analyze

# l10n generate
.PHONY: l10n
l10n:
	fvm flutter gen-l10n

# code generate
.PHONY: build-runner
build-runner:
	fvm flutter packages pub run build_runner build --delete-conflicting-outputs

# code generate watch
.PHONY: build-runner-watch
build-runner-watch:
	fvm flutter packages pub run build_runner watch --delete-conflicting-outputs

# run test
.PHONY: test
test:
	fvm flutter test


################################################################################################
## å®Ÿè¡Œãƒ»ãƒ“ãƒ«ãƒ‰
################################################################################################
# run dev
.PHONY: run-dev
run-dev:
	fvm flutter run --dart-define=FLAVOR=${DEV_FLAVOR} --target lib/main.dart

# run dev (with Device Preview)
.PHONY: run-dev-preview
run-dev-preview:
	fvm flutter run --dart-define=FLAVOR=${DEV_FLAVOR} --dart-define=PREVIEW=true --target lib/main.dart

# run prod
.PHONY: run-prod
run-prod:
	fvm flutter run --release --dart-define=FLAVOR=${PROD_FLAVOR} --target lib/main.dart

# build APK dev
.PHONY: build-android-dev
build-android-dev:
	fvm flutter build apk --dart-define=FLAVOR=$(DEV_FLAVOR) --target lib/main.dart

# build APK prod
.PHONY: build-android-prod
build-android-prod:
	fvm flutter build apk --release --dart-define=FLAVOR=$(PROD_FLAVOR) --target lib/main.dart

# build IOS dev
.PHONY: build-ios-dev
build-ios-dev:
	fvm flutter build ios --dart-define=FLAVOR=$(DEV_FLAVOR) --target lib/main.dart

# build IOS prod
.PHONY: build-ios-prod
build-ios-prod:
	fvm flutter build ios --release --dart-define=FLAVOR=$(PROD_FLAVOR) --target lib/main.dart
```

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ãªã©ãŒä½¿ãˆã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

```shell
# format
make format

# å®Ÿè¡Œ(devç’°å¢ƒ)
make run-dev

# å®Ÿè¡Œ(devç’°å¢ƒãƒ»Device Previewæœ‰åŠ¹)
make run-dev-preview
```

## Visual Studio Codeã®è¨­å®š

vscodeã§ãƒ‡ãƒãƒƒã‚°æ§‹æˆã‚’ã„ãã¤ã‹è¿½åŠ ã—ã¦ãŠãã¾ã™ã€‚

```shell
$ mkdir -p .vscode
$ touch .vscode/launch.json
```

```json:.vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "run dev",
      "request": "launch",
      "type": "dart",
      "program": "lib/main.dart",
      "args": ["--dart-define=FLAVOR=dev"]
    },
    {
      "name": "run dev (with Device Preview)",
      "request": "launch",
      "type": "dart",
      "program": "lib/main.dart",
      "args": ["--dart-define=FLAVOR=dev", "--dart-define=PREVIEW=true"]
    },
    {
      "name": "run prod",
      "request": "launch",
      "type": "dart",
      "program": "lib/main.dart",
      "args": ["--dart-define=FLAVOR=prod"]
    }
  ]
}
```

ãƒ•ã‚¡ã‚¤ãƒ«éè¡¨ç¤ºã®è¨­å®šã‚‚ã§ãã¾ã™ã€‚`node_modules`ã¨ã‹ã¯åŸºæœ¬ä¸­ã‚’è¦‹ã‚‹ã“ã¨ã¯ãªã„ã¨æ€ã†ã®ã§ã€è¨­å®šã—ã¦ãŠãã¾ã™ã€‚

```shell
$ touch .vscode/settings.json
```

```json:.vscode/settings.json
{
  "files.exclude": {
    ".dart_tool": true,
    ".idea": true,
    "build": true,
    "node_modules": true,
    ".flutter-plugins": true,
    ".flutter-plugins-dependencies": true,
    ".metadata": true,
    ".packages": true,
    "yarn.lock": true,
    "pubspec.lock": true
  }
}
```

# çµ‚ã‚ã‚Šã«

ä»Šå›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹æˆã¯ã€åŒã˜ãå­¦ç”Ÿã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®å‹é”ã®å½±éŸ¿ã‚’ã‚‚ã‚ã«å—ã‘ã¦ã¾ã™ğŸ˜‹
å‚™å¿˜éŒ²ã¨ã—ã¦æ›¸ã„ãŸã¤ã‚‚ã‚ŠãŒã€ã‚ã¡ã‚ƒãã¡ã‚ƒä¸å¯§ã«ã¾ã¨ã‚ã¦ã—ã¾ã£ã¦ã€æ°—ã¥ã„ãŸã‚‰æ–‡å­—æ•°ãŒã‚¨ã‚°ã„ã“ã¨ã«ãªã£ã¦ã¾ã—ãŸç¬‘ï¼ˆå’è«–ã¯ã“ã‚Œã§æå‡ºã—ãŸã„ã€ã€ï¼‰

ã¡ãªã¿ã«ãƒªãƒã‚¸ãƒˆãƒªã¯ã“ã¡ã‚‰ã«å…¬é–‹ã—ã¦ãŠã‚Šã¾ã™ã®ã§ã€ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã¨ã—ã¦ä½¿ã£ã¦ã‚‚ã‚‰ã£ã¦ã‚‚å…¨ç„¶OKã§ã™ï¼

https://github.com/Alesion30/flapp-mvvm-templete